
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>luxun quick start - Abstraction Builder</title>
  <meta name="author" content="Bulldog">

  
  <meta name="description" content="luxun quick start">
  <meta name="keywords" content="distributed, persistent queue, kafka">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://bulldog2011.github.com/blog/2013/04/03/luxun-quick-start/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Abstraction Builder" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">ab</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">Abstraction Builder</a></h1>
  
    <h2>Building simple and elegant programming abstractions</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:bulldog2011.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/lab">Lab</a></li>
  <li><a href="/about">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">Luxun Quick Start</h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-04-03T17:01:00+08:00" pubdate data-updated="true">Apr 3<span>rd</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Step 0 : Prerequisite</h2>

<p>To use Luxun, you need to have JDK 1.6 or above installed on your operating system, and Luxun supports <strong><em>Windows</em></strong> and <strong><em>Linux</em></strong> operation systems.</p>

<!--more-->


<h2>Step 1 : Download Luxun package</h2>

<p>Download a recent stable release by following instructions on <a href="https://github.com/bulldog2011/luxun">Luxun github site</a>, then extract zip file to a local folder.  Current(when this post is written) stable release is <a href="https://github.com/bulldog2011/bulldog-repo/raw/master/repo/releases/com/leansoft/luxun/0.6.0/luxun-0.6.0-bin.zip">0.6.0</a>.</p>

<p>Luxun distribution provides scripts(in <code>bin</code> folder) for both Windows and Linux environments, the demo below is made in a windows environment, if you are using Linux environment, please change script accordingly.</p>

<h2>Step 2 : Start the server</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>D:\test\luxun-0.6.0>bin\server.bat conf\server.properties
</span><span class='line'>2013-04-03 16:36:18.856 INFO  [LuxunServer] Starting luxun server 0.6
</span><span class='line'>2013-04-03 16:36:18.872 INFO  [LogManager] starting log cleaner every 600000 ms.
</span><span class='line'>2013-04-03 16:36:18.888 INFO  [ThriftServer] Wating server to start, time waited : 0 s.
</span><span class='line'>2013-04-03 16:36:19.902 INFO  [ThriftServer] Thrift server started on port : 9092
</span><span class='line'>2013-04-03 16:36:19.902 INFO  [LuxunServer] Server started.</span></code></pre></td></tr></table></div></figure>


<h2>Step 3 : Send some messages</h2>

<p>Luxun comes with a command line client that will take input from standard input and send it out as messages to the Luxun server. Each line will be sent as a separate message. The topic <code>demo</code> is created automatically when messages are sent to it. You should see something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>D:\test\luxun-0.6.0>bin\producer-console.bat --broker-list 0:localhost:9092 --topic demo
</span><span class='line'>Enter your message and exit with empty string.
</span><span class='line'>> Welcome to Luxun
</span><span class='line'>Message sent : Welcome to Luxun
</span><span class='line'>> 鲁迅是一个伟大的中国作家
</span><span class='line'>Message sent : 鲁迅是一个伟大的中国作家
</span><span class='line'>></span></code></pre></td></tr></table></div></figure>


<h2>Step 4 : Start a consumer</h2>

<p>Luxun also has a command line consumer that will dump out messages to standard output.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>D:\test\luxun-0.6.0>bin\simple-consumer-console --topic demo --server luxun://localhost:9092
</span><span class='line'>
</span><span class='line'>[1] 0: Welcome to Luxun
</span><span class='line'>[2] 1: 鲁迅是一个伟大的中国作家</span></code></pre></td></tr></table></div></figure>


<p>If you have each of the above commands running in a different terminal then you should now be able to type messages into the producer terminal and see them appear in the consumer terminal.</p>

<p>Both of these command line tools have additional options. Running the command with no arguments will display usage information documenting them in more detail.</p>

<p><code>simple-consumer-console</code> is built on Luxun&#8217;s simple consumer, there is also a similar <code>consumer-console</code> which is built on Luxun&#8217;s advanced consumer. Both can be used for demo and testing.</p>

<h2>Step 5 : Write some code</h2>

<p>Below is some very simple examples of using Luxun for message producing and consuming, for consuming part,  <code>SimpleConsumer</code> is used, both <code>consume by index</code> and <code>consume by fanout id</code> are demonstrated in every case.</p>

<h4>Setup &amp; Cleanup</h4>

<p>The demos are showed as unit test cases, before every test cases, we set up two brokers and two simple consumers for testing, after every test cases, we do some cleanup:</p>

<figure class='code'><figcaption><span>SimpleDemo.java </span><a href='https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/SimpleDemo.java'>source </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="kd">private</span> <span class="kt">int</span> <span class="n">brokerId1</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">int</span> <span class="n">brokerId2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">int</span> <span class="n">port1</span> <span class="o">=</span> <span class="mi">9092</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kt">int</span> <span class="n">port2</span> <span class="o">=</span> <span class="mi">9093</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">LuxunServer</span> <span class="n">server1</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">LuxunServer</span> <span class="n">server2</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">brokerList</span> <span class="o">=</span> <span class="n">brokerId1</span> <span class="o">+</span> <span class="s">&quot;:localhost:&quot;</span> <span class="o">+</span> <span class="n">port1</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">brokerId2</span> <span class="o">+</span> <span class="s">&quot;:localhost:&quot;</span> <span class="o">+</span> <span class="n">port2</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">broker1</span> <span class="o">=</span> <span class="n">brokerId1</span> <span class="o">+</span> <span class="s">&quot;:localhost:&quot;</span> <span class="o">+</span> <span class="n">port1</span><span class="o">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="kd">private</span> <span class="n">SimpleConsumer</span> <span class="n">simpleConsumer1</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">SimpleConsumer</span> <span class="n">simpleConsumer2</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nd">@Before</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="c1">// set up 2 brokers</span>
</span><span class='line'>      <span class="n">Properties</span> <span class="n">props1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span><span class='line'>      <span class="n">props1</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;brokerid&quot;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">brokerId1</span><span class="o">));</span>
</span><span class='line'>      <span class="n">props1</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;port&quot;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">port1</span><span class="o">));</span>
</span><span class='line'>      <span class="n">props1</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;log.dir&quot;</span><span class="o">,</span> <span class="n">TestUtils</span><span class="o">.</span><span class="na">createTempDir</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">());</span>
</span><span class='line'>      <span class="n">ServerConfig</span> <span class="n">config1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerConfig</span><span class="o">(</span><span class="n">props1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">server1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LuxunServer</span><span class="o">(</span><span class="n">config1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">server1</span><span class="o">.</span><span class="na">startup</span><span class="o">();</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">Properties</span> <span class="n">props2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span><span class='line'>      <span class="n">props2</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;brokerid&quot;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">brokerId2</span><span class="o">));</span>
</span><span class='line'>      <span class="n">props2</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;port&quot;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">port2</span><span class="o">));</span>
</span><span class='line'>      <span class="n">props2</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;log.dir&quot;</span><span class="o">,</span> <span class="n">TestUtils</span><span class="o">.</span><span class="na">createTempDir</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">());</span>
</span><span class='line'>      <span class="n">ServerConfig</span> <span class="n">config2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerConfig</span><span class="o">(</span><span class="n">props2</span><span class="o">);</span>
</span><span class='line'>      <span class="n">server2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LuxunServer</span><span class="o">(</span><span class="n">config2</span><span class="o">);</span>
</span><span class='line'>      <span class="n">server2</span><span class="o">.</span><span class="na">startup</span><span class="o">();</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// set up two simple consumers</span>
</span><span class='line'>      <span class="c1">// create a consumer 1 to connect to the Luxun server running on localhost, port 9092, socket timeout of 60 secs</span>
</span><span class='line'>      <span class="n">simpleConsumer1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleConsumer</span><span class="o">(</span><span class="s">&quot;localhost&quot;</span><span class="o">,</span> <span class="n">port1</span><span class="o">,</span> <span class="mi">60000</span><span class="o">);</span>
</span><span class='line'>      <span class="c1">// create a consumer 2 to connect to the Luxun server running on localhost, port 9093, socket timeout of 60 secs</span>
</span><span class='line'>      <span class="n">simpleConsumer2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleConsumer</span><span class="o">(</span><span class="s">&quot;localhost&quot;</span><span class="o">,</span> <span class="n">port2</span><span class="o">,</span> <span class="mi">60000</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@After</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cleanup</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">server1</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>      <span class="n">server2</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>      <span class="n">simpleConsumer2</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">Utils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">server1</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getLogDir</span><span class="o">()));</span>
</span><span class='line'>      <span class="n">Utils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">server2</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">getLogDir</span><span class="o">()));</span>
</span><span class='line'>      <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">500</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Send a single message</h4>

<figure class='code'><figcaption><span>SimpleDemo.java </span><a href='https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/SimpleDemo.java'>source </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="nd">@Test</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendSingleMessage</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;serializer.class&quot;</span><span class="o">,</span> <span class="n">StringEncoder</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;broker.list&quot;</span><span class="o">,</span> <span class="n">broker1</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerConfig</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="n">config</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="s">&quot;test-message&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> <span class="c1">// finish with the producer</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by index</span>
</span><span class='line'>      <span class="n">List</span><span class="o">&lt;</span><span class="n">MessageList</span><span class="o">&gt;</span> <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">MessageList</span> <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by fanout id</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">fanoutId</span> <span class="o">=</span> <span class="s">&quot;demo&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="n">fanoutId</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Send multiple messages in one request</h4>

<figure class='code'><figcaption><span>SimpleDemo.java </span><a href='https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/SimpleDemo.java'>source </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="nd">@Test</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMultipleMessages</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;serializer.class&quot;</span><span class="o">,</span> <span class="n">StringEncoder</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;broker.list&quot;</span><span class="o">,</span> <span class="n">broker1</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerConfig</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="n">config</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">messages</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
</span><span class='line'>      <span class="n">messages</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;test-message1&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messages</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;test-message2&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messages</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;test-message3&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="n">messages</span><span class="o">);</span>
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> <span class="c1">// finish with the producer</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by index</span>
</span><span class='line'>      <span class="n">List</span><span class="o">&lt;</span><span class="n">MessageList</span><span class="o">&gt;</span> <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">MessageList</span> <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">3</span><span class="o">);</span>
</span><span class='line'>      <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>          <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by fanout id</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">fanoutId</span> <span class="o">=</span> <span class="s">&quot;demo&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="n">fanoutId</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">3</span><span class="o">);</span>
</span><span class='line'>      <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>          <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Send messages to different topics</h4>

<figure class='code'><figcaption><span>SimpleDemo.java </span><a href='https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/SimpleDemo.java'>source </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="nd">@Test</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMessagesToDifferentTopics</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;serializer.class&quot;</span><span class="o">,</span> <span class="n">StringEncoder</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;broker.list&quot;</span><span class="o">,</span> <span class="n">broker1</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerConfig</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="n">config</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="s">&quot;test-topic1&quot;</span><span class="o">,</span> <span class="s">&quot;test-message1&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">data1</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="s">&quot;test-topic2&quot;</span><span class="o">,</span> <span class="s">&quot;test-message2&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">data2</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> <span class="c1">// finish with the producer</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by index</span>
</span><span class='line'>      <span class="n">List</span><span class="o">&lt;</span><span class="n">MessageList</span><span class="o">&gt;</span> <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic1&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">MessageList</span> <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message1&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic2&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message2&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by fanoutId</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">fanoutId</span> <span class="o">=</span> <span class="s">&quot;demo&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic1&quot;</span><span class="o">,</span> <span class="n">fanoutId</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message1&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic2&quot;</span><span class="o">,</span> <span class="n">fanoutId</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message2&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Send messages with GZIP compression</h4>

<figure class='code'><figcaption><span>SimpleDemo.java </span><a href='https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/SimpleDemo.java'>source </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="nd">@Test</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMessageWithGZIPCompression</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;serializer.class&quot;</span><span class="o">,</span> <span class="n">StringEncoder</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;broker.list&quot;</span><span class="o">,</span> <span class="n">broker1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;compression.codec&quot;</span><span class="o">,</span> <span class="s">&quot;1&quot;</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerConfig</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="n">config</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="s">&quot;test-message&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> <span class="c1">// finish with the producer</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by index</span>
</span><span class='line'>      <span class="n">List</span><span class="o">&lt;</span><span class="n">MessageList</span><span class="o">&gt;</span> <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">MessageList</span> <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="n">CompressionCodec</span><span class="o">.</span><span class="na">GZIP</span><span class="o">,</span> <span class="n">messageList</span><span class="o">.</span><span class="na">getCompressionCodec</span><span class="o">());</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by fanout id</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">fanoutId</span> <span class="o">=</span> <span class="s">&quot;demo&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="n">fanoutId</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="n">CompressionCodec</span><span class="o">.</span><span class="na">GZIP</span><span class="o">,</span> <span class="n">messageList</span><span class="o">.</span><span class="na">getCompressionCodec</span><span class="o">());</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Send messages with async producer</h4>

<figure class='code'><figcaption><span>SimpleDemo.java </span><a href='https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/SimpleDemo.java'>source </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="nd">@Test</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMessageWithAsyncProducer</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;serializer.class&quot;</span><span class="o">,</span> <span class="n">StringEncoder</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;producer.type&quot;</span><span class="o">,</span> <span class="s">&quot;async&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;broker.list&quot;</span><span class="o">,</span> <span class="n">broker1</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerConfig</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="n">config</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="s">&quot;test-message&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> <span class="c1">// finish with the producer</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by index</span>
</span><span class='line'>      <span class="n">List</span><span class="o">&lt;</span><span class="n">MessageList</span><span class="o">&gt;</span> <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">MessageList</span> <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by fanout id</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">fanoutId</span> <span class="o">=</span> <span class="s">&quot;demo&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="n">fanoutId</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Send messages with custom partitioner</h4>

<figure class='code'><figcaption><span>CustomPartitioner.java </span><a href='https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/CustomPartitioner.java'>source </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">leansoft</span><span class="o">.</span><span class="na">luxun</span><span class="o">.</span><span class="na">quickstart</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.leansoft.luxun.producer.IPartitioner</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomPartitioner</span> <span class="kd">implements</span> <span class="n">IPartitioner</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">partition</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="kt">int</span> <span class="n">numBrokers</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">%</span> <span class="n">numBrokers</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>SimpleDemo.java </span><a href='https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/SimpleDemo.java'>source </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="nd">@Test</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMessagesWithCustomPartitioner</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;serializer.class&quot;</span><span class="o">,</span> <span class="n">StringEncoder</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;broker.list&quot;</span><span class="o">,</span> <span class="n">brokerList</span><span class="o">);</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;partitioner.class&quot;</span><span class="o">,</span> <span class="n">CustomPartitioner</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerConfig</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="n">config</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// will be sent to broker 1 since (the length of key % num of brokers) = 0</span>
</span><span class='line'>      <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="s">&quot;test-topic1&quot;</span><span class="o">,</span> <span class="s">&quot;key1&quot;</span><span class="o">,</span> <span class="s">&quot;test-message1&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">data1</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// will be went to broker 2 since (the length of key % num of brokers) = 1</span>
</span><span class='line'>      <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="s">&quot;test-topic2&quot;</span><span class="o">,</span> <span class="s">&quot;key11&quot;</span><span class="o">,</span> <span class="s">&quot;test-message2&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">data2</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> <span class="c1">// finish with the producer</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by index</span>
</span><span class='line'>      <span class="n">List</span><span class="o">&lt;</span><span class="n">MessageList</span><span class="o">&gt;</span> <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic1&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">MessageList</span> <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message1&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer2</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic2&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message2&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by fanoutId</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">fanoutId</span> <span class="o">=</span> <span class="s">&quot;demo&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic1&quot;</span><span class="o">,</span> <span class="n">fanoutId</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message1&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer2</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic2&quot;</span><span class="o">,</span> <span class="n">fanoutId</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message2&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Send messages with custom encoder</h4>

<figure class='code'><figcaption><span>LogEventEncoder.java </span><a href='https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/LogEventEncoder.java'>source </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">leansoft</span><span class="o">.</span><span class="na">luxun</span><span class="o">.</span><span class="na">quickstart</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.leansoft.luxun.message.Message</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.leansoft.luxun.serializer.Encoder</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.leansoft.luxun.serializer.ThriftConverter</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogEventEncoder</span> <span class="kd">implements</span> <span class="n">Encoder</span><span class="o">&lt;</span><span class="n">LogEvent</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">toMessage</span><span class="o">(</span><span class="n">LogEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kt">byte</span><span class="o">[]</span> <span class="n">binary</span> <span class="o">=</span> <span class="n">ThriftConverter</span><span class="o">.</span><span class="na">toBytes</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">Message</span><span class="o">(</span><span class="n">binary</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>LogEventDecoder.java </span><a href='https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/LogEventDecoder.java'>source </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">leansoft</span><span class="o">.</span><span class="na">luxun</span><span class="o">.</span><span class="na">quickstart</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.leansoft.luxun.message.Message</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.leansoft.luxun.serializer.Decoder</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.leansoft.luxun.serializer.ThriftConverter</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogEventDecoder</span> <span class="kd">implements</span> <span class="n">Decoder</span><span class="o">&lt;</span><span class="n">LogEvent</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">LogEvent</span> <span class="nf">toEvent</span><span class="o">(</span><span class="n">Message</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kt">byte</span><span class="o">[]</span> <span class="n">binary</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
</span><span class='line'>      <span class="k">return</span> <span class="o">(</span><span class="n">LogEvent</span><span class="o">)</span> <span class="n">ThriftConverter</span><span class="o">.</span><span class="na">toEvent</span><span class="o">(</span><span class="n">binary</span><span class="o">,</span> <span class="n">LogEvent</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>SimpleDemo.java </span><a href='https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/SimpleDemo.java'>source </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="nd">@Test</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMessageWithCustomEncoder</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;serializer.class&quot;</span><span class="o">,</span> <span class="n">LogEventEncoder</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;broker.list&quot;</span><span class="o">,</span> <span class="n">broker1</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerConfig</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">LogEvent</span><span class="o">&gt;</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">LogEvent</span><span class="o">&gt;(</span><span class="n">config</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">LogEvent</span> <span class="n">logEvent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LogEvent</span><span class="o">();</span>
</span><span class='line'>      <span class="n">logEvent</span><span class="o">.</span><span class="na">createdTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span><span class='line'>      <span class="n">logEvent</span><span class="o">.</span><span class="na">hostId</span> <span class="o">=</span> <span class="s">&quot;127.0.0.1&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">logEvent</span><span class="o">.</span><span class="na">logLevel</span> <span class="o">=</span> <span class="n">LogLevel</span><span class="o">.</span><span class="na">INFO</span><span class="o">;</span>
</span><span class='line'>      <span class="n">logEvent</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="s">&quot;a test log message&quot;</span><span class="o">;</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">LogEvent</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">LogEvent</span><span class="o">&gt;(</span><span class="s">&quot;log-topic&quot;</span><span class="o">,</span> <span class="n">logEvent</span><span class="o">);</span>
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> <span class="c1">// finish with the producer</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by index</span>
</span><span class='line'>      <span class="n">LogEventDecoder</span> <span class="n">decoder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LogEventDecoder</span><span class="o">();</span>
</span><span class='line'>      <span class="n">List</span><span class="o">&lt;</span><span class="n">MessageList</span><span class="o">&gt;</span> <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;log-topic&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">MessageList</span> <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="n">logEvent</span><span class="o">,</span> <span class="n">decoder</span><span class="o">.</span><span class="na">toEvent</span><span class="o">(</span><span class="n">message</span><span class="o">));</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by fanout id</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">fanoutId</span> <span class="o">=</span> <span class="s">&quot;demo&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;log-topic&quot;</span><span class="o">,</span> <span class="n">fanoutId</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertEquals</span><span class="o">(</span><span class="n">logEvent</span><span class="o">,</span> <span class="n">decoder</span><span class="o">.</span><span class="na">toEvent</span><span class="o">(</span><span class="n">message</span><span class="o">));</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Consume messages with different fanout id</h4>

<figure class='code'><figcaption><span>SimpleDemo.java </span><a href='https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/SimpleDemo.java'>source </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="nd">@Test</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">consumeMessageWithDifferentFanoutId</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;serializer.class&quot;</span><span class="o">,</span> <span class="n">StringEncoder</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>      <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;broker.list&quot;</span><span class="o">,</span> <span class="n">broker1</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">ProducerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerConfig</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="n">config</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerData</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="s">&quot;test-message&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
</span><span class='line'>          <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">producer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> <span class="c1">// finish with the producer</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// consume by different fanout id independently</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">fanoutId</span> <span class="o">=</span> <span class="s">&quot;group-a&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">List</span><span class="o">&lt;</span><span class="n">MessageList</span><span class="o">&gt;</span> <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="n">fanoutId</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">100</span><span class="o">);</span>
</span><span class='line'>      <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">MessageList</span> <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span><span class='line'>          <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>          <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>          <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">fanoutId</span> <span class="o">=</span> <span class="s">&quot;group-b&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="n">fanoutId</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">100</span><span class="o">);</span>
</span><span class='line'>      <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">MessageList</span> <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span><span class='line'>          <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>          <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>          <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">fanoutId</span> <span class="o">=</span> <span class="s">&quot;group-c&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">listOfMessageList</span> <span class="o">=</span> <span class="n">simpleConsumer1</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="s">&quot;test-topic&quot;</span><span class="o">,</span> <span class="n">fanoutId</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
</span><span class='line'>      <span class="n">assertTrue</span><span class="o">(</span><span class="n">listOfMessageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">100</span><span class="o">);</span>
</span><span class='line'>      <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">MessageList</span> <span class="n">messageList</span> <span class="o">=</span> <span class="n">listOfMessageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span><span class='line'>          <span class="n">assertTrue</span><span class="o">(</span><span class="n">messageList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>          <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messageList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>          <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;test-message&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Step 6 : Study advanced demo</h2>

<p>You can find the source of an advanced demo <a href="https://github.com/bulldog2011/luxun/blob/master/src/test/java/com/leansoft/luxun/quickstart/AdvancedDemo.java">here</a>, this demo shows:</p>

<blockquote><ol>
<li>Multiple topics</li>
<li>Multiple threads concurrent producing and consuming</li>
<li>The use of <code>StreamFactory</code> to create advanced stream style consumers</li>
<li>Group consuming</li>
</ol>
</blockquote>

<p>Below is a figure vividly show the demo scenario:
<img class="center" src="/images/luxun/demo.png" width="600" height="800"></p>

<blockquote><ol>
<li>There are two brokers.</li>
<li>There are two topics, topic <code>star</code>(marked as green) and topic <code>moon</code>(marked as blue), in each broker.</li>
<li>Two topic <code>star</code> producer threads(marked as green) will produce topic <code>star</code> messages to two brokers.</li>
<li>Four topic <code>moon</code> producer threads(marked as blue) will produce topic <code>moon</code> messages to two brokers.</li>
<li>There are two consumer groups.</li>
<li>In consumer group A, there are two topic <code>star</code> consumer threads(marked as green) and one topic <code>moon</code> consumer thread(marked as blue).</li>
<li>In consume group B, there are four topic <code>star</code> consumer threads(marked as green) and two topic <code>moon</code> consumer threads(marked as blue).</li>
</ol>
</blockquote>

<p>Within same consumer group, message for a topic will be consumed by one and only one consumer, for example, in consumer group B, although there are four topic <code>star</code> consumers, every topic <code>star</code> message can only be consumed by exact one topic <code>star</code> consumer, this is just the <code>consume once</code> queue semantics.</p>

<p>Among different consumer groups, message for a topic will be consumed by each consumer group, for example, both <code>star</code> consumers in consumer group A and group B will get their respective topic <code>star</code> message copy, this is just the <code>fanout</code> queue semantics.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Bulldog</span></span>

      








  


<time datetime="2013-04-03T17:01:00+08:00" pubdate data-updated="true">Apr 3<span>rd</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/luxun/'>luxun</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://bulldog2011.github.com/blog/2013/04/03/luxun-quick-start/" data-via="" data-counturl="http://bulldog2011.github.com/blog/2013/04/03/luxun-quick-start/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left articlenav" href="/blog/2013/04/01/pico-and-ebay-trading-api-integration-how-to/" title="Previous Post: pico and ebay trading api integration how to">&laquo; pico and ebay trading api integration how to</a>
      
      
        <a class="basic-alignment right articlenav" href="/blog/2013/04/15/wsdl-driven-development-on-android-the-big-picture/" title="Next Post: WSDL Driven Development on Android - the Big Picture">WSDL Driven Development on Android - the Big Picture &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/big-queue/'>big queue (7)</a></li>
<li class='category'><a href='/blog/categories/design/'>design (4)</a></li>
<li class='category'><a href='/blog/categories/ebay-api/'>ebay api (2)</a></li>
<li class='category'><a href='/blog/categories/luxun/'>luxun (2)</a></li>
<li class='category'><a href='/blog/categories/misc/'>misc (1)</a></li>
<li class='category'><a href='/blog/categories/nano/'>nano (11)</a></li>
<li class='category'><a href='/blog/categories/pico/'>pico (7)</a></li>

  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/04/15/nano-tutorial-1-a-number-conversion-sample/">Nano Tutorial 1 - a Number Conversion Sample</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/15/wsdl-driven-development-on-android-the-big-picture/">WSDL Driven Development on Android - the Big Picture</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/03/luxun-quick-start/">luxun quick start</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/01/pico-and-ebay-trading-api-integration-how-to/">pico and ebay trading api integration how to</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/31/pico-tutoiral-5-hello-amazon-product-advertising-api/">Pico Tutoiral 5 - Hello Amazon Product Advertising API</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Bulldog -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bulldogtech';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://bulldog2011.github.com/blog/2013/04/03/luxun-quick-start/';
        var disqus_url = 'http://bulldog2011.github.com/blog/2013/04/03/luxun-quick-start/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
